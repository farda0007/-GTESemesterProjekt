@page
@model ÆGTESemesterProjekt.Pages.ShoppingCart.MyCartModel
@{
    decimal totalPrice = Model.MyCartProducts?.Sum(cart => cart.Count * (cart.Product?.Price ?? 0)) ?? 0;
}
<h1>Min kurv</h1>
<br />
<div class="test">
    <table class="table table-bordered table-hover table-striped" width="60%">
        <thead>
            <tr class="btn-secondary active">
                <th>Product Id</th>
                <th>Product Name</th>
                <th>Product Price</th>
                <th>Count</th>
                <th>Total Order Price</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.MyCartProducts != null && Model.MyCartProducts.Any())
            {
                foreach (var shoppingCart in Model.MyCartProducts)
                {
                    <tr class="btn-secondary">
                        <td>@shoppingCart.ProductId</td>
                        <td>@(shoppingCart.Product?.ProductName ?? "Product Name Not Available")</td>
                        <td>@(shoppingCart.Product?.Price.ToString("C") ?? "0.00")</td>
                        <td>@shoppingCart.Count</td>
                        <td>@(shoppingCart.Count * (shoppingCart.Product?.Price ?? 0)).ToString("C")</td>
                    </tr>
                }
                <tr>
                    <td colspan="4" class="text-right"><strong>Total Price:</strong></td>
                    <td>@totalPrice.ToString("C")</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<form method="post">
    <div class="form-group">
        <label for="DiscountCode">Discount Code:</label>
        <input type="text" id="DiscountCode" name="DiscountCode" class="form-control" value="@Model.DiscountCode" />
    </div>
    <div class="form-group">
        <input type="hidden" id="Totalprice" name="Totalprice" value="@totalPrice" />
    </div>
    <button type="submit" class="btn btn-primary">Apply Discount</button>
</form>

@if (Model.DiscountApplied)
{
    <div>
        <p>Rabatkode aktiveret @Model.DiscountAmount</p>
        <p>Pris efter Rabat @Model.FinalPrice</p>
    </div>
}

<a asp-page="/Order/Checkout" class="btn btn-primary">Proceed to Order</a>